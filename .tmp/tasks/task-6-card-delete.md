# Task 6: カード削除機能の実装

## 概要

カンバンボードに表示されているカードを削除する機能を実装します。ユーザーがカードの削除ボタン（ゴミ箱アイコン）をクリックすると、確認ダイアログが表示され、OKをクリックするとカードが削除されます。

## 目的

- 既存カードを削除可能にする
- 削除前に確認ダイアログを表示してユーザーの意図を確認する
- 削除内容をlocalStorageに永続化する
- 削除後の状態を即座に画面に反映する

## 実装範囲

### 1. データ管理層（`js/data-manager.js`）

#### `deleteCard(cardId)`

**概要**: 指定されたカードを削除します。

**引数**:
- `cardId` (string): 削除対象のカードID

**戻り値**: 削除されたカードオブジェクト（`columnId`を含む）

**処理内容**:
1. `cardsData`配列から`cardId`に一致するカードのインデックスを検索
2. カードが見つからない場合はエラーをスロー
3. カードのインデックスが見つかった場合、削除前にカードオブジェクトを保存
4. `cardsData.splice(index, 1)`でカードを削除
5. `saveToStorage(cardsData)`を呼び出して永続化
6. 削除されたカードオブジェクトを返す
7. エラーが発生した場合は`throw new Error()`でエラーメッセージを投げる

**エラーケース**:
- 指定されたカードIDが存在しない場合

---

### 2. イベントハンドラー層（`js/event-handler.js`）

#### `handleDeleteCard(cardId)`

**概要**: カード削除処理を実行します。

**引数**:
- `cardId` (string): 削除対象のカードID

**戻り値**: なし

**処理内容**:
1. `window.confirm()`で確認ダイアログを表示
   - メッセージ: 「このカードを削除しますか？」
2. ユーザーがキャンセルした場合は処理を終了（早期リターン）
3. `try-catch`ブロック内で以下を実行:
   - `deleteCard(cardId)`を呼び出してカードを削除し、削除されたカードオブジェクトを取得
   - 削除されたカードの`columnId`を使用して`renderColumnCards(columnId)`を呼び出し、該当カラムを再描画
   - `showMessage('カードを削除しました', 'success')`で成功メッセージを表示
4. エラーが発生した場合:
   - `showMessage(error.message, 'danger')`でエラーメッセージを表示

#### `setupCardActionListeners()`の更新

**概要**: カードのアクションボタン（編集・削除）のイベントリスナーを設定します。

**更新内容**:
- 既存の編集ボタン処理に加えて、削除ボタン（`.delete-btn`）の処理を追加
- 削除ボタンの場合:
  - カード要素（`.kanban-card`）を取得
  - `data-card-id`属性からカードIDを取得
  - `handleDeleteCard(cardId)`を呼び出す

**実装パターン**:
- 既存のイベントデリゲーションコードに削除ボタンの処理を追加
- 編集ボタンと削除ボタンの両方に対応

---

## データフロー

```text
ユーザー操作
    ↓
1. カードの削除ボタン（ゴミ箱アイコン）クリック
    ↓
2. setupCardActionListeners() がイベントをキャッチ
    ↓
3. handleDeleteCard(cardId) が実行される
    - window.confirm()で確認ダイアログを表示
    - ユーザーがキャンセルした場合は早期リターン
    ↓
4. deleteCard(cardId) でデータを削除
    - カード検索（findIndex）
    - cardsData.splice()で削除
    - localStorageに保存
    - 削除されたカードオブジェクト（columnIdを含む）を返す
    ↓
5. 返されたカードの columnId を使用して renderColumnCards(columnId) で該当カラムを再描画
    ↓
6. showMessage() で成功メッセージを表示
```

## 修正ファイル一覧

1. `js/data-manager.js`
   - `deleteCard(cardId)` 関数を追加

2. `js/event-handler.js`
   - `handleDeleteCard(cardId)` 関数を追加
   - `setupCardActionListeners()` 関数を更新（削除ボタン対応）

## 動作確認項目

- [ ] カードの削除ボタン（ゴミ箱アイコン）をクリックして確認ダイアログが表示される
- [ ] 確認ダイアログに「このカードを削除しますか？」と表示される
- [ ] 確認ダイアログでキャンセルをクリックするとカードが削除されない
- [ ] 確認ダイアログでOKをクリックするとカードが削除される
- [ ] 画面からカードが即座に消える
- [ ] 成功メッセージ「カードを削除しました」が表示される
- [ ] ページをリロードしてもカードが削除されたまま
- [ ] 存在しないカードIDでエラーメッセージが表示される

## 注意事項

1. **既存機能への影響を最小限に**:
   - 既存の`setupCardActionListeners()`関数に削除ボタンの処理を追加
   - 編集機能が正常に動作し続けることを確認

2. **エラーハンドリング**:
   - すべてのエラーは`throw new Error()`で投げます
   - エラーメッセージは具体的でわかりやすいものにします

3. **確認ダイアログ**:
   - `window.confirm()`を使用して、削除前にユーザーの意図を確認
   - ユーザーがキャンセルした場合は何もしない（早期リターン）

4. **戻り値の統一**:
   - `deleteCard()`は削除されたカードオブジェクトを返す
   - これにより、`updateCard()`と同様に効率的な再描画が可能

5. **デグレーション防止**:
   - 既存のカード追加機能が正常に動作することを確認
   - 既存のカード編集機能が正常に動作することを確認

## 完了条件

- すべての動作確認項目がチェック済みであること
- カード削除機能が完全に動作すること
- 既存のカード追加・編集機能が正常に動作し続けること
- エラーケースが適切に処理されること
